package keys

import (
	"fmt"
	"testing"

	"github.com/goat-systems/go-tezos/v3/internal/testutils"
	"github.com/stretchr/testify/assert"
)

func Test_NewKey(t *testing.T) {
	type want struct {
		wantErr     bool
		containsErr string
		secretKey   string
		publicKey   string
		address     string
	}

	cases := []struct {
		name  string
		input NewKeyInput
		want  want
	}{
		{
			"is successful with edesk",
			NewKeyInput{
				Esk:      "edesk1fddn27MaLcQVEdZpAYiyGQNm6UjtWiBfNP2ZenTy3CFsoSVJgeHM9pP9cvLJ2r5Xp2quQ5mYexW1LRKee2",
				Password: "password12345##",
				Kind:     Ed25519,
			},
			want{
				false,
				"",
				"edskRsPBsKuULoLTEQV2R9UbvSZbzFqvoESvp1mYyQJU8xi9mJamt88r5uTXbWQpVHjSiPWWtnoyqTCuSLQLxbEKUXfwwTccsF",
				"edpkuHMDkMz46HdRXYwom3xRwqk3zQ5ihWX4j8dwo2R2h8o4gPcbN5",
				"tz1L8fUQLuwRuywTZUP5JUw9LL3kJa8LMfoo",
			},
		},
		{
			"is successful with mnemonic",
			NewKeyInput{
				Kind:     Ed25519,
				Mnemonic: "normal dash crumble neutral reflect parrot know stairs culture fault check whale flock dog scout",
				Password: "PYh8nXDQLB",
				Email:    "vksbjweo.qsrgfvbw@tezos.example.org",
			},
			want{
				false,
				"",
				"edskRxB2DmoyZSyvhsqaJmw5CK6zYT7dbkUfEVSiQeWU1gw3ZMnC99QMMXru3imsbUrLhvuHktrymvNqhMxkhz7Y4LJAtevW5V",
				"edpkvEoAbkdaGALxi2FfeefB8hUkMZ4J1UVwkzyumx2GvbVpkYUHnm",
				"tz1Qny7jVMGiwRrP9FikRK95jTNbJcffTpx1",
			},
		},
		{
			"is successful with base58",
			NewKeyInput{
				Kind:          Ed25519,
				EncodedString: "edskRxB2DmoyZSyvhsqaJmw5CK6zYT7dbkUfEVSiQeWU1gw3ZMnC99QMMXru3imsbUrLhvuHktrymvNqhMxkhz7Y4LJAtevW5V",
			},
			want{
				false,
				"",
				"edskRxB2DmoyZSyvhsqaJmw5CK6zYT7dbkUfEVSiQeWU1gw3ZMnC99QMMXru3imsbUrLhvuHktrymvNqhMxkhz7Y4LJAtevW5V",
				"edpkvEoAbkdaGALxi2FfeefB8hUkMZ4J1UVwkzyumx2GvbVpkYUHnm",
				"tz1Qny7jVMGiwRrP9FikRK95jTNbJcffTpx1",
			},
		},
	}

	for _, tt := range cases {
		t.Run(tt.name, func(t *testing.T) {
			key, err := NewKey(tt.input)
			testutils.CheckErr(t, tt.want.wantErr, tt.want.containsErr, err)
			assert.Equal(t, tt.want.secretKey, key.GetSecretKey())
			assert.Equal(t, tt.want.publicKey, key.PubKey.GetPublicKey())
			assert.Equal(t, tt.want.address, key.PubKey.GetPublicKeyHash())
		})
	}

}

func Test_Sign(t *testing.T) {
	op := "115b28c818a3f0af897fa687e252ea12502ffe2be56ee2eaf2eb6083cdde23a36c0072172ff3890a9b72ad1a2271cde3593301e08924fd16b5a94dabcd0100ffc8d90a0000fc075e014f7f8f619e60f00b314c2b8297f2b724006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16b6a94dabcd0100b3f7ce0a014abe4c4c0b891997c489bbe616beb915ee77b20000006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16b7a94dabcd0100d0e5930a0184c2ecd27a94864bdba804870364ac8a40c9133400006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16b8a94dabcd01009df8f706018b88e99e66c1c2587f87118449f781cb7d44c9c400006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16b9a94dabcd0100f8d99e0501535b38258cc90f5ca57ff96b790a1dfc35c9348d00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16baa94dabcd0100d28aeb0400008fdff3c16e4bc870445bee84d90c84415852841b006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16bba94dabcd0100c8f3ea0400009c82e620875f81979b5cc068d3315ca1b716598b006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16bca94dabcd0100f9bc86030163122eff324d1c9e4a14d9bd8730d0b3d25f0e8700006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16bda94dabcd0100a6a0b60201ecdebd858790fe26566a9dbf184d9bc92739be7300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16bea94dabcd0100f08aac0201ead5d920a278b3aa0ee2a0ccc4cbb4575b88ac5200006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16bfa94dabcd0100ea999002000014be10910b0fa385f88aea0603dd93b64c4b6589006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c0a94dabcd01009fbcff010167f7fe4cd1bf5e3543828c7c2ce3ae31bf1253a100006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c1a94dabcd0100818ef2010000feca89e2200a9db744f83cdcc384cd93287b845f006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c2a94dabcd0100f6f3ce0101149a2b308ac665929c79ab00b1e0cf26ee5095c200006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c3a94dabcd0100a6d2b00101065181dfd5d4a96439bed2639256e9b013d0eddf00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c4a94dabcd010086a39b0101f3d6a2b73ff384c34b3cf2774f98062bc10fc78900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c5a94dabcd0100e1c193010000f0d9bb30f76f5b7be83c634b9a851e5dff43e1c9006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c6a94dabcd0100aceb880101be02deecf7657010e9dbf50a75da9e1d3779a17d00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c7a94dabcd0100abbe80010122a1afd192cacd32b31a6b3b56cbf918e289d9f900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c8a94dabcd0100d1c678016b9696af35c55f7a590152f42caa66ce3973846500006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16c9a94dabcd0100b5985f0000e9e59c5eeaf9c4b29f68adcf095e4cc44c6f3a70006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16caa94dabcd01009b915e010fb78888a2b5e1f6909b3b9673ab4552defd57d300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16cba94dabcd0100988a590000ef24ba668a866d2e786a6933cd7c9022397b66fc006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16cca94dabcd0100a0d756000020877114da2d292a2ca020c0accd0412c164b65c006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16cda94dabcd0100908b3f0125b4959e921b9f1564109e2734d79e7bbb4a453300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16cea94dabcd0100c8fe3e01cc75b6f3d43af375484714ed3492cbeefc0c14e800006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16cfa94dabcd0100d0b737016e12b19c00b97e9470899886f6053c871cf7566500006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d0a94dabcd0100cec83300006a031c412b23ae21d900755ea04d5582d9f19f01006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d1a94dabcd0100dcd73001cec47dc5cce4cfc78265c0d245c924a91fa3232a00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d2a94dabcd0100dbc9300101d5360ff574cf7559fb5d1b2a49dbdb8eb0e01d00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d3a94dabcd01009aaa30010672820f68ec71dedb02f0a4f0331a4e110950e000006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d4a94dabcd0100ada8300129fa2d3ca8b88a5a659a54f52245ebeef276e06900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d5a94dabcd0100e7a63001ab0a504243982d452259587e4f844cb38b6747af00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d6a94dabcd0100f0a53001acdd7a03036947f7b8d0fdb6b06b5be9b20957a300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d7a94dabcd0100a1a53001996fb4b36d4b4f53e14fd6d5358c135143de436800006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d8a94dabcd0100a1a53001da6242c5c42acaccf65e928695485017b91d1ac900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16d9a94dabcd0100b4a62f018de468afe972ad0f56aefd843c303148023e47b700006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16daa94dabcd0100db8e2e012056cfc4a7934583a8e10185cf2dde8c1f152b0c00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16dba94dabcd0100ffe72d0000ff2bda48661bd38e3aec986f8bcb4adc0f9860ee006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16dca94dabcd0100ebe02d00007ac10060785bdfedcfb96fd72628ad29c22519e5006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16dda94dabcd0100abf32c01730628830e7b19da86f0c4ce8ff1f78b377c7d9300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16dea94dabcd0100e9ab2c0000f07aa2da869862b3f1baa999222192e279a7b979006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16dfa94dabcd010092a02c000058d9b6b4e4654bfbc92ede41299b53be9a3c508d006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e0a94dabcd0100dd812c0000363431cd3e41f82673c8c3c93974fcd7ccc30a68006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e1a94dabcd0100a2a422000072172ff3890a9b72ad1a2271cde3593301e08924006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e2a94dabcd01009cd5160000693b03b57cfd569b9ebb91804b84dfa8fb7edfbd006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e3a94dabcd0100a4b11101718b7c548f24a945fd2dbc96060201c93f94eb1300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e4a94dabcd0100e7b4090114cd9174e349150fabd4592e1729770fbb5237e600006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e5a94dabcd0100b6aa0801a7229ca080b7d9ae3d81d419439d706bcffae6d100006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e6a94dabcd01009be40501302a0f482cd55202961dbfadf4f2f02c7e3711a200006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e7a94dabcd01009fe0040000abb0039b20bd94cdb92ac9576c1567e8236b4466006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e8a94dabcd0100caad030000643fdd3a83b7912ddff191e591372aa4ad4166a8006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16e9a94dabcd0100e3900300006dd234de12d4593d89be456c188464546238cfd4006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16eaa94dabcd0100d0b10200006d7a8607389ff3e5c658780933b757b814fa5f10006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16eba94dabcd01009c95020116ad636206385f085f2a46e6cb332b4d48efb5f500006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16eca94dabcd0100aec5010126e562405cd7a3b24511a43a230e67423e996b7c00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16eda94dabcd01009eba010102422380c375c2db0cf6a4bf3d70199bfe16b8d900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16eea94dabcd0100b9a9010105135559571d98c74fa8a2e79332135fecac3cd900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16efa94dabcd0100c58d010000a33692e5d56a87ddfa8ac77f83c1be9758a1bff0006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f0a94dabcd0100ec7700004e77993d6fd4f4631a995170d4908beab7770fb0006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f1a94dabcd0100be4701e53004111983786a6fa1b6bfecf8746210afb3c000006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f2a94dabcd0100d43e018593daf833c3deb73dfc1452f55e2a4823f0855300006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f3a94dabcd0100ed31018cfd53f8b1bd3653281dcb3a0151079f8f7a3c3700006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f4a94dabcd0100e62a01962333bca0ee7d91800c1ce2261e826eec756f9400006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f5a94dabcd0100a52801ef620f4a0dbba6e0328594e5f6e577f53b1ee0fd00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f6a94dabcd0100f90b0000c5b889df999fa5628acd168513ae1bebd3b87ece006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f7a94dabcd0100f80b0170d0a1cb3931227ee6461c8fd7eeecc46cac6b7900006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f8a94dabcd0100fa09000043a86d4749f6e7a372f24d5d3c41f9182b12136e006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16f9a94dabcd0100e60901bb1ab39332c1dcb68f4acfe7a5b10efff175d61c00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16faa94dabcd0100f10701147d73ac09a1e4babc342b74d5c35c0c28fb607f00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16fba94dabcd01009e0700009ec702b577a58039fb917d48d6d287f0e53e0631006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16fca94dabcd0100f70601b6b3e2336b5e7b8e63e2234fbaa61a8cefc8ea1c00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16fda94dabcd0100c20401039b8f37a0cfdd28d689fdd876c9f155fc72a03400006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16fea94dabcd0100990401bab2c04b8b64930c22056b52c73f0e54112791ce00006c0072172ff3890a9b72ad1a2271cde3593301e08924fd16ffa94dabcd0100cb01016aa36ededab0153fd9cacf00c16d8fb1fa6d0ae800006c0072172ff3890a9b72ad1a2271cde3593301e08924fd1680aa4dabcd0100770170094ba35f65e5ede12e0637a917b294b61dbc0600006c0072172ff3890a9b72ad1a2271cde3593301e08924fd1681aa4dabcd010077019a6f81da5f533ff457407a2b0d90599ded9a7a8100006c0072172ff3890a9b72ad1a2271cde3593301e08924fd1682aa4dabcd01007201434d10c5e3ab096fe443d5f2194a2915236e5cb60000"
	key, err := NewKey(NewKeyInput{
		Esk:      "edesk1y93K7TseGiZV5SeySjBV5RBGysgyn3D1ogayXQdiA6138qwydPgoX6BpVEhpTF36ywWHTDSYyZnYY9F8TD",
		Password: "I am anonymous.13",
		Kind:     Ed25519,
	})
	assert.Nil(t, err)
	_, err = key.Sign(SignInput{
		Message: fmt.Sprintf("03%s", op),
	})
	assert.Nil(t, err)

}
